AnchorLayout:
    canvas.before:
        Color:
            rgba: 0.2, 0.2, 0.2, 1
        Rectangle:
            pos: self.pos
            size: self.size
    BoxLayout:
        orientation: "horizontal"
        spacing: 10
        size_hint: 0.85, 0.90
        size_hint_max: 1920, 1080   # use ifs instead of this in the end
        size_hint_min: 494, 374       #
        BoxLayout:                                                  # left side
            size_hint: 0.44, 1
            orientation: "vertical"
            Image:                                            # grayscale image - can't anchor on bottom for some reason
                id: grayscale_img
                source: app.resource_path("assets/d.jpg")
                size_hint: 1, 0.80
            Label:
                size_hint: 1, 0.05
                id: grayscale_counter
                color: (0.443, 0.443, 0.443, 1) if root.ids.n_g.disabled and root.ids.p_g.disabled else (1, 1, 1, 1)
            AnchorLayout:                                                  # left & right gallery buttons
                size_hint: 1, 0.05
                BoxLayout:
                    size_hint: 0.4, 1
                    Button:
                        size_hint: 0.5, 1
                        text: "<"
                        background_down: ''
                        background_normal: ''
                        background_disabled_normal: ''
                        background_color: (0.2, 0.2, 0.2, 1)
                        on_press: self.background_color = (0.35, 0.35, 0.35, 1)
                        color: (0.443, 0.443, 0.443, 1) if self.disabled else (1, 1, 1, 1)
                        on_release: self.background_color = ((0.2, 0.2, 0.2, 1) if self.disabled else (0.2902, 0.2902, 0.2902, 1))
                        id: p_g
                        on_release: app.p_g()
                    Button:
                        size_hint: 0.5, 1
                        text: ">"
                        background_down: ''
                        background_normal: ''
                        background_disabled_normal: ''
                        background_color: (0.2, 0.2, 0.2, 1)
                        on_press: self.background_color = (0.35, 0.35, 0.35, 1)
                        color: (0.443, 0.443, 0.443, 1) if self.disabled else (1, 1, 1, 1)
                        on_release: self.background_color = ((0.2, 0.2, 0.2, 1) if self.disabled else (0.2902, 0.2902, 0.2902, 1))
                        id: n_g
                        on_release: app.n_g()
            BoxLayout:                                                  # start & upload buttons
                size_hint: 1, 0.1
                Button:
                    size_hint: 0.5, 1
                    id: load
                    text: "load"
                    background_down: ''
                    background_normal: ''
                    background_disabled_normal: ''
                    background_color: (0.2, 0.2, 0.2, 1)
                    on_press: self.background_color = (0.35, 0.35, 0.35, 1)
                    color: (0.443, 0.443, 0.443, 1) if self.disabled else (1, 1, 1, 1)
                    on_release: self.background_color = ((0.2, 0.2, 0.2, 1) if self.disabled else (0.2902, 0.2902, 0.2902, 1))
                    on_release: app.show_load()
                Button:
                    id: start
                    size_hint: 0.5, 1
                    text: "start"
                    background_down: ''
                    background_normal: ''
                    background_disabled_normal: ''
                    background_color: (0.2, 0.2, 0.2, 1)
                    on_press: self.background_color = (0.35, 0.35, 0.35, 1)
                    color: (0.443, 0.443, 0.443, 1) if self.disabled else (1, 1, 1, 1)
                    on_release: self.background_color = ((0.2, 0.2, 0.2, 1) if self.disabled else (0.2902, 0.2902, 0.2902, 1))
                    on_release: app.start()
        BoxLayout:                                                                 # middle
            orientation: "vertical"
            size_hint: 0.12, 1
            ProgressBar:                                                     # Progress bar
                opacity: 0
                size_hint: 0, 0
                id: pb
                max: 1000
            Image:
                size_hint: 1, 0.55
                canvas:
                    BorderImage:
                        border: (0, 0, 0, 0)
                        pos: self.x, self.y
                        size: self.width, self.width * 473/512
                        source: app.resource_path('assets/gray.jpg')
                    BorderImage:
                        border: [int(min(self.width * (root.ids.pb.value / float(root.ids.pb.max)) if root.ids.pb.max else 0, 12))] * 4
                        pos: self.x, self.y
                        size: self.width * (root.ids.pb.value / float(root.ids.pb.max)) if root.ids.pb.max else 0, self.width * 473/512
                        source: app.resource_path('assets/green.png')
                    BorderImage:
                        border: (0, 0, 0, 0)
                        pos: self.x, self.y
                        size: self.width, self.width * 473/512
                        source: app.resource_path('assets/progress_bar.png')
            Label:
                size_hint: 1, 0.05
                id: done_counter
                text: "0 / 0"
                color: (0.443, 0.443, 0.443, 1) if self.text[4] == "0" else (1, 1, 1, 1)
            Button:
                size_hint: 1, 0.1
                text: "cancel"
                id: cancel
                background_down: ''
                background_normal: ''
                background_disabled_normal: ''
                background_color: (0.2, 0.2, 0.2, 1)
                on_press: self.background_color = (0.35, 0.35, 0.35, 1)
                color: (0.443, 0.443, 0.443, 1) if self.disabled else (1, 1, 1, 1)
                on_release: self.background_color = ((0.2, 0.2, 0.2, 1) if self.disabled else (0.2902, 0.2902, 0.2902, 1))
                on_release: app.cancel()
            BoxLayout:
                size_hint: 1, 0.4
        BoxLayout:                                                  # right side
            size_hint: 0.44, 1
            orientation: "vertical"
            Image:                                             # colored image - can't anchor on bottom for some reason
                id: colorized_img
                size_hint: 1, 0.80
                source: app.resource_path("assets/d.jpg")
            Label:
                size_hint: 1, 0.05
                id: colorized_counter
                color: (0.443, 0.443, 0.443, 1) if root.ids.p_c.disabled and root.ids.n_c.disabled else (1, 1, 1, 1)
            AnchorLayout:                                                  # left & right gallery buttons
                size_hint: 1, 0.05
                BoxLayout:
                    size_hint: 0.4, 1
                    Button:
                        size_hint: 0.5, 1
                        text: "<"
                        background_down: ''
                        background_normal: ''
                        background_disabled_normal: ''
                        background_color: (0.2, 0.2, 0.2, 1)
                        on_press: self.background_color = (0.35, 0.35, 0.35, 1)
                        color: (0.443, 0.443, 0.443, 1) if self.disabled else (1, 1, 1, 1)
                        on_release: self.background_color = ((0.2, 0.2, 0.2, 1) if self.disabled else (0.2902, 0.2902, 0.2902, 1))
                        id: p_c
                        on_release: app.p_c()
                    Button:
                        size_hint: 0.5, 1
                        text: ">"
                        background_down: ''
                        background_normal: ''
                        background_disabled_normal: ''
                        background_color: (0.2, 0.2, 0.2, 1)
                        on_press: self.background_color = (0.35, 0.35, 0.35, 1)
                        color: (0.443, 0.443, 0.443, 1) if self.disabled else (1, 1, 1, 1)
                        on_release: self.background_color = ((0.2, 0.2, 0.2, 1) if self.disabled else (0.2902, 0.2902, 0.2902, 1))
                        id: n_c
                        on_release: app.n_c()
            BoxLayout:                                                  # save & save all buttons
                size_hint: 1, 0.1
                Button:
                    id: save
                    size_hint: 0.5, 1
                    text: "save"
                    background_down: ''
                    background_normal: ''
                    background_disabled_normal: ''
                    background_color: (0.2, 0.2, 0.2, 1)
                    on_press: self.background_color = (0.35, 0.35, 0.35, 1)
                    color: (0.443, 0.443, 0.443, 1) if self.disabled else (1, 1, 1, 1)
                    on_release: self.background_color = ((0.2, 0.2, 0.2, 1) if self.disabled else (0.2902, 0.2902, 0.2902, 1))
                    on_release: app.show_save()
                Button:
                    id: save_all
                    size_hint: 0.5, 1
                    text: "save all"
                    background_down: ''
                    background_normal: ''
                    background_disabled_normal: ''
                    background_color: (0.2, 0.2, 0.2, 1)
                    on_press: self.background_color = (0.35, 0.35, 0.35, 1)
                    color: (0.443, 0.443, 0.443, 1) if self.disabled else (1, 1, 1, 1)
                    on_release: self.background_color = ((0.2, 0.2, 0.2, 1) if self.disabled else (0.2902, 0.2902, 0.2902, 1))
                    on_release: app.show_save_all()

<LoadDialog>:
    BoxLayout:
        size: root.size
        pos: root.pos
        orientation: "vertical"
        FileChooserIconView:
            id: filechooser
            dirselect: True
            multiselect: True
            path: app.load_path
            on_submit: root.load()

        BoxLayout:
            size_hint_y: None
            height: 30
            Button:
                text: "Cancel"
                on_release: root.cancel()

            Button:
                text: "Load"
                on_release: root.load(filechooser.selection, filechooser.path)

<SaveDialog>:
    text_input: text_input
    BoxLayout:
        size: root.size
        pos: root.pos
        orientation: "vertical"
        FileChooserIconView:
            id: filechooser
            path: app.save_path

        TextInput:
            id: text_input
            size_hint_y: None
            height: 30
            multiline: False

        BoxLayout:
            size_hint_y: None
            height: 30
            Button:
                text: "Cancel"
                on_release: root.cancel()

            Button:
                text: "Save"
                on_release: root.save(filechooser.path, text_input.text)

<SaveAllDialog>:
    BoxLayout:
        size: root.size
        pos: root.pos
        orientation: "vertical"
        FileChooserIconView:
            id: filechooser
            path: app.save_path

        BoxLayout:
            size_hint_y: None
            height: 30
            Button:
                text: "Cancel"
                on_release: root.cancel()

            Button:
                text: "Save"
                on_release: root.save(filechooser.path)

<ErrorDialog>
    BoxLayout:
        size: root.size
        pos: root.pos
        orientation: "vertical"
        Label:
            text: "Permission error"
        Button:
            text: "OK"
            on_release: root.ok()